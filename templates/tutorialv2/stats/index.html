{% extends "tutorialv2/base.html" %}
{% load i18n %}
{% load crispy_forms_tags %}
{% load append_query_params %}

{% block title %}
    {% trans "Statistiques du contenu" %}
{% endblock %}

{% block breadcrumb %}
    <li>{{ content.title }}</li>
{% endblock %}


{% block content_out %}
    <!--TODO those should not be needed -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>

    <section class="full-content-wrapper">
        <h2 class="ico-after ico-tutorials">
            {% block headline %}
                {% blocktrans with content_title=content.title %}
                    Statistiques du contenu : {{content_title}}
                {% endblocktrans %}
            {% endblock %}
        </h2>

        <div class="stat-graph-container">
            <div class="stat-graph">
                <canvas id="view-graph"
                        data-time='[{% for view in pageviews %}"{{view.date}}"{% if not forloop.last %},{% endif %}{% endfor %}]'
                        data-views="[{% for view in pageviews %}{{view.pageviews}} {% if not forloop.last %},{% endif %}{% endfor %}]"
                        data-label="{% trans 'Évolution du nombre de pages vues' %}">
                </canvas>
            </div>

            <div class="stat-graph">
                <canvas id="visit-time-graph"
                        data-time='[{% for view in pagetime %}"{{view.date}}"{% if not forloop.last %},{% endif %}{% endfor %}]'
                        data-views="[{% for view in pagetime %}{{view.time}} {% if not forloop.last %},{% endif %}{% endfor %}]"
                        data-label="{% trans 'Évolution du temps moyen de lecture' %}">
                </canvas>
            </div>
        </div>

        <!--TODO check that a leat one stats is available, else display error msg-->
        <table class="fullwidth">
            <thead>
                <th>{% trans "URL" %}</th>
                <th>{% trans "Vues" %}</th>
                <th class="wide">{% trans "Temps moyen sur la page" %}</th>
            </thead>
            <tbody>
                {% for view in cumulative_stats_by_url %}
                    <tr>
                        <!-- TODO this could be a link to the online version/part/chapter -->
                        <td>{{ view.url }}</td>
                        <td>{{ view.pageviews}}</td>
                        <td class="wide">{{ view.avgTimeOnPage}}</td>
                        <!-- TODO convert me from seconds to hh:mm:ss if needed --->
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <h2>{% trans "Comparer deux pages entres-elles" %}</h2>
        {% crispy form %}
        <!-- TODO add submit btn -->
        <!-- TODO put the select side by side -->


    </section>
{% endblock %}

{% block sidebar_actions %}
<div class="mobile-menu-bloc mobile-all-links mobile-show-ico" data-title="Actions">
    <!--TODO missing style for default and active filter-->
    <h3>{% trans "Échelle de temps" %}</h3>
    <ul>
        <li>
            <a href="{% append_query_params days=7 %}">
                <span>
                    {% trans "7 derniers jours" %}
                </span>
            </a>
        </li>
        <li>
            <a href="{% append_query_params days=30 %}">
                <span>
                    {% trans "30 derniers jours" %}
                </span>
            </a>
        </li>
        <li>
            <a href="{% append_query_params days=365 %}">
                <span>
                    {% trans "La dernière année" %}
                </span>
            </a>
        </li>
    </ul>
</div>
{% endblock sidebar_actions %}
